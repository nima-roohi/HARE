import testing ;

project testcase

  : requirements <toolset>clang:<cxxflags>"-isystem/opt/c++/libs/boost-1.69-clang-8.0.0/include/boost-1_69"
  : requirements <toolset>clang:<cxxflags>"-isystem/opt/c++/libs/gmp-6.1.2-clang-8.0.0/include"
  : requirements <toolset>clang:<linkflags>"-L/opt/c++/libs/boost-1.69-clang-8.0.0/lib"
  : requirements <toolset>clang:<linkflags>-L/opt/c++/libs/gmp-6.1.2-clang-8.0.0/lib
  : requirements <toolset>clang:<linkflags>"-Wl,-rpath /opt/c++/libs/boost-1.69-clang-8.0.0/lib/"
  : requirements <toolset>clang:<linkflags>"-lboost_unit_test_framework-clang-darwin80-x64-1_69"
  : requirements <toolset>clang:<dll-path>/opt/c++/libs/boost-1.69-clang-8.0.0/lib

  : requirements <toolset>gcc:<cxxflags>"-isystem/opt/c++/libs/boost-1.69-gcc-8.3.0/include/boost-1_69"
  : requirements <toolset>gcc:<cxxflags>"-isystem/opt/c++/libs/gmp-6.1.2-gcc-8.3.0/include"
  : requirements <toolset>gcc:<linkflags>"-L/opt/c++/libs/boost-1.69-gcc-8.3.0/lib"
  : requirements <toolset>gcc:<linkflags>-L/opt/c++/libs/gmp-6.1.2-gcc-8.3.0/lib
  : requirements <toolset>gcc:<linkflags>"-Wl,-rpath /opt/c++/libs/boost-1.69-gcc-8.3.0/lib/"
  : requirements <toolset>gcc:<linkflags>"-lboost_unit_test_framework-gcc8-x64-1_69"
  : requirements <toolset>gcc:<dll-path>/opt/c++/libs/boost-1.69-gcc-8.3.0/lib

  : requirements <include>"$(SRC)/../test"
  : requirements <linkflags>"-lgmp -lgmpxx"
  : requirements <testing.arg>"--log_level=message"

  ;



alias test-all
	: cmn-namespace exception utils serialization term tokenizer
  ;

unit-test cmn-namespace  # cmn is somehow a keyword in Mac
	: test_runner.cpp  [ GLOB cmn : *.cpp : tmp.cpp ] [ GLOB $(SRC)/cmn : *.cpp ]
  :
  ;

unit-test exception
	: test_runner.cpp  [ GLOB cmn/exception : *.cpp ]
  :
  ;

unit-test utils
	: test_runner.cpp  [ glob-tree-ex cmn/utils : *.cpp ]
  :
  ;

unit-test serialization
	: test_runner.cpp  [ glob-tree-ex cmn/serialization : *.cpp ] [ glob-tree-ex $(SRC)/cmn/serialization : *.cpp ]
  :
  ;

unit-test term
	: test_runner.cpp  [ glob-tree-ex cmn/term : *.cpp ] [ glob-tree-ex $(SRC)/cmn/serialization : *.cpp ]
  : <include>.
  ;

unit-test tokenizer
	: test_runner.cpp  [ glob-tree-ex cmn/tokenizer : *.cpp ] [ glob-tree-ex $(SRC)/cmn/tokenizer : *.cpp ] [ glob-tree-ex $(SRC)/cmn/serialization : *.cpp ]
  :
  ;

unit-test iostream
	: test_runner.cpp  [ glob-tree-ex cmn/iostream : *.cpp ]
  : <toolset>clang:<linkflags>"-lboost_iostreams-clang-darwin80-x64-1_69"
    <toolset>gcc:<linkflags>"-lboost_iostreams-gcc8-x64-1_69"
  ;

unit-test tmp
	: tmp.cpp  [ GLOB $(SRC)/cmn : *.cpp ]
  :
  ;


unit-test tmp2
	: tmp2.cpp
  :
  ;


# <cxxflags>"-fsanitize=address -fno-omit-frame-pointer"
# <linkflags>"-fsanitize=address -fno-omit-frame-pointer"
